(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{9721:function(t,e,r){Promise.resolve().then(r.bind(r,6713)),Promise.resolve().then(r.t.bind(r,7754,23)),Promise.resolve().then(r.t.bind(r,6866,23))},6713:function(t,e,r){"use strict";r.d(e,{AppProvider:function(){return d},q:function(){return p}});var a=r(7821),n=r(8078),o=r(2949);class s{async request(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new AbortController,a="".concat(this.baseUrl).concat(t),n={...e.headers||{}};e.body&&(n["Content-Type"]="application/json");try{let t=await fetch(a,{...e,headers:n,signal:r.signal});if(!t.ok){let e="HTTP ".concat(t.status);try{e=(await t.json()).detail||e}catch(t){}if(401===t.status)throw Error("Unauthorized");throw Error(e)}if(204===t.status)return null;return t.json()}catch(t){if("AbortError"===t.name)return;throw t}}signIn(t,e){return this.request("/auth/signin",{method:"POST",body:JSON.stringify({email:t,password:e})})}signUp(t,e){return this.request("/auth/signup",{method:"POST",body:JSON.stringify({email:t,password:e})})}signOut(){return Promise.resolve()}getTasks(t){return this.request("/tasks",{headers:{Authorization:"Bearer ".concat(t)}})}getTaskById(t,e){return this.request("/tasks/".concat(t),{headers:{Authorization:"Bearer ".concat(e)}})}createTask(t,e){return this.request("/tasks",{method:"POST",headers:{Authorization:"Bearer ".concat(e)},body:JSON.stringify(t)})}updateTask(t,e,r){return this.request("/tasks/".concat(t),{method:"PUT",headers:{Authorization:"Bearer ".concat(r)},body:JSON.stringify(e)})}deleteTask(t,e){return this.request("/tasks/".concat(t),{method:"DELETE",headers:{Authorization:"Bearer ".concat(e)}})}toggleTaskCompletion(t,e){return this.request("/tasks/".concat(t,"/toggle"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(e)}})}constructor(){var t;this.baseUrl=null!==(t=o.env.NEXT_PUBLIC_API_BASE_URL)&&void 0!==t?t:"http://127.0.0.1:8000/api"}}let i=new s,u={user:null,token:null,tasks:[],loadingState:{auth:!1,tasks:!1},error:null},l=(t,e)=>{switch(e.type){case"SET_USER":return{...t,user:e.payload.user,token:e.payload.token,error:null};case"LOGOUT":return{...u};case"SET_TASKS":return{...t,tasks:e.payload,loadingState:{...t.loadingState,tasks:!1}};case"ADD_TASK":return{...t,tasks:[...t.tasks,e.payload]};case"UPDATE_TASK":return{...t,tasks:t.tasks.map(t=>t.id===e.payload.id?e.payload:t)};case"DELETE_TASK":return{...t,tasks:t.tasks.filter(t=>t.id!==e.payload)};case"SET_LOADING":return{...t,loadingState:{...t.loadingState,[e.payload.section]:e.payload.value}};case"SET_ERROR":return{...t,error:e.payload,loadingState:{auth:!1,tasks:!1}};default:return t}},c=(0,n.createContext)(void 0),d=t=>{let{children:e}=t,[r,o]=(0,n.useReducer)(l,u);(0,n.useEffect)(()=>{let t=localStorage.getItem("token"),e=localStorage.getItem("user");if(t&&e)try{o({type:"SET_USER",payload:{token:t,user:JSON.parse(e)}})}catch(t){localStorage.clear()}},[]);let s=async(t,e)=>{o({type:"SET_LOADING",payload:{section:"auth",value:!0}});try{let r=await i.signIn(t,e);localStorage.setItem("token",r.token),localStorage.setItem("user",JSON.stringify({user_id:r.user_id,email:r.email})),o({type:"SET_USER",payload:{token:r.token,user:{user_id:r.user_id,email:r.email}}})}catch(t){throw o({type:"SET_ERROR",payload:t.message}),t}finally{o({type:"SET_LOADING",payload:{section:"auth",value:!1}})}},d=async(t,e)=>{o({type:"SET_LOADING",payload:{section:"auth",value:!0}});try{let r=await i.signUp(t,e);localStorage.setItem("token",r.token),localStorage.setItem("user",JSON.stringify({user_id:r.user_id,email:r.email})),o({type:"SET_USER",payload:{token:r.token,user:{user_id:r.user_id,email:r.email}}})}catch(t){throw o({type:"SET_ERROR",payload:t.message}),t}finally{o({type:"SET_LOADING",payload:{section:"auth",value:!1}})}},p=async()=>{if(r.token){o({type:"SET_LOADING",payload:{section:"tasks",value:!0}});try{let t=await i.getTasks(r.token);o({type:"SET_TASKS",payload:t})}catch(t){o({type:"SET_ERROR",payload:t.message})}}},y=async t=>{r.token&&o({type:"ADD_TASK",payload:await i.createTask(t,r.token)})},h=async(t,e)=>{r.token&&o({type:"UPDATE_TASK",payload:await i.updateTask(t,e,r.token)})},f=async t=>{r.token&&(await i.deleteTask(t,r.token),o({type:"DELETE_TASK",payload:t}))},T=async t=>{r.token&&o({type:"UPDATE_TASK",payload:await i.toggleTaskCompletion(t,r.token)})};return(0,a.jsx)(c.Provider,{value:{...r,signIn:s,signUp:d,signOut:()=>{localStorage.clear(),o({type:"LOGOUT"})},fetchTasks:p,createTask:y,updateTask:h,deleteTask:f,toggleTaskCompletion:T},children:e})},p=()=>{let t=(0,n.useContext)(c);if(!t)throw Error("useApp must be used inside AppProvider");return t}},2949:function(t,e,r){"use strict";var a,n;t.exports=(null==(a=r.g.process)?void 0:a.env)&&"object"==typeof(null==(n=r.g.process)?void 0:n.env)?r.g.process:r(3862)},3862:function(t){!function(){var e={229:function(t){var e,r,a,n=t.exports={};function o(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function i(t){if(e===setTimeout)return setTimeout(t,0);if((e===o||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(r){try{return e.call(null,t,0)}catch(r){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:o}catch(t){e=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(t){r=s}}();var u=[],l=!1,c=-1;function d(){l&&a&&(l=!1,a.length?u=a.concat(u):c=-1,u.length&&p())}function p(){if(!l){var t=i(d);l=!0;for(var e=u.length;e;){for(a=u,u=[];++c<e;)a&&a[c].run();c=-1,e=u.length}a=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function y(t,e){this.fun=t,this.array=e}function h(){}n.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];u.push(new y(t,e)),1!==u.length||l||i(p)},y.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=h,n.addListener=h,n.once=h,n.off=h,n.removeListener=h,n.removeAllListeners=h,n.emit=h,n.prependListener=h,n.prependOnceListener=h,n.listeners=function(t){return[]},n.binding=function(t){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw Error("process.chdir is not supported")},n.umask=function(){return 0}}},r={};function a(t){var n=r[t];if(void 0!==n)return n.exports;var o=r[t]={exports:{}},s=!0;try{e[t](o,o.exports,a),s=!1}finally{s&&delete r[t]}return o.exports}a.ab="//";var n=a(229);t.exports=n}()},6866:function(){},7754:function(t){t.exports={style:{fontFamily:"'__Inter_f367f3', '__Inter_Fallback_f367f3'",fontStyle:"normal"},className:"__className_f367f3"}}},function(t){t.O(0,[884,115,364,744],function(){return t(t.s=9721)}),_N_E=t.O()}]);